import { ref, onMounted, watchEffect } from "vue";
import { gsap } from "@/utils/useGSAP.js";

export const cloudAnim = (el, startIndex = 0) => {
  const cloudPaths = [
    "M135.94,40.74h0c0,7.51,6.08,13.59,13.58,13.59h99.3c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58h-22.57c-7.5,0-13.58,6.08-13.58,13.58h0c0,7.51,6.08,13.59,13.58,13.59h48.33c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58H88.15c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h13.25c7.5,0,13.58-6.08,13.58-13.58h0c0-7.51-6.08-13.59-13.58-13.59H13.58c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h37.17c7.5,0,13.58-6.08,13.58-13.58h0c0-7.51-6.08-13.59-13.58-13.59h-15.47c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h300.92c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58h-186.68c-7.5,0-13.58,6.08-13.58,13.58Z",
    "M244.38,40.74h0c0,7.51,6.08,13.59,13.58,13.59h16.94c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58h-105.21c-7.5,0-13.58,6.08-13.58,13.58h0c0,7.51,6.08,13.59,13.58,13.59h8.41c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58H31.59c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h25.25c7.5,0,13.58-6.08,13.58-13.58h0c0-7.51-6.08-13.59-13.58-13.59H13.58c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h145.61c7.5,0,13.58-6.08,13.58-13.58h0c0-7.51-6.08-13.59-13.58-13.59h-4.8c-7.5,0-13.58-6.08-13.58-13.58h0C140.81,6.08,146.89,0,154.39,0h151.97c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58h-48.4c-7.5,0-13.58,6.08-13.58,13.58Z",
    "M128.05,40.75h0c0,7.5,6.08,13.58,13.58,13.58h122.23c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58h-37.26c-7.5,0-13.58,6.08-13.58,13.58h0c0,7.51,6.08,13.59,13.58,13.59h92.77c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58H59.84c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h47.91c7.5,0,13.58-6.08,13.58-13.58h0c0-7.51-6.08-13.59-13.58-13.59H13.58c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h40.28c7.5,0,13.58-6.08,13.58-13.58h0c0-7.5-6.08-13.58-13.58-13.58h-28.56c-7.5,0-13.58-6.08-13.58-13.58h0C11.72,6.08,17.8,0,25.3,0h306.47c7.5,0,13.58,6.08,13.58,13.58h0c0,7.51-6.08,13.59-13.58,13.59h-190.14c-7.5,0-13.58,6.08-13.58,13.58Z",
    "M378.02,13.58h0c0,7.5-6.08,13.58-13.58,13.58h-139.43c-7.5,0-13.58,6.08-13.58,13.58h0c0,7.51,6.08,13.59,13.58,13.59h59.6c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58H107.6c-7.5,0-13.58,6.08-13.58,13.58h0c0,7.51,6.08,13.59,13.58,13.59h101.14c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58H22.88c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h15.87c7.5,0,13.58-6.08,13.58-13.58h0c0-7.51-6.08-13.59-13.58-13.59H13.58c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h112.66c7.5,0,13.58-6.08,13.58-13.58h0c0-7.51-6.08-13.59-13.58-13.59h-54.47c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h292.67c7.5,0,13.58,6.08,13.58,13.58Z",
    "M238.98,40.75h0c0,7.5,6.08,13.58,13.58,13.58h122.61c7.5,0,13.58,6.08,13.58,13.58h0c0,7.51-6.08,13.59-13.58,13.59h-175.02c-7.5,0-13.58,6.08-13.58,13.58h0c0,7.5,6.08,13.58,13.58,13.58h111.16c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58H81.57c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h15.73c7.5,0,13.58-6.08,13.58-13.58h0c0-7.5-6.08-13.58-13.58-13.58h-32.4c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.51,6.08-13.59,13.58-13.59h132.89c7.5,0,13.58-6.08,13.58-13.58h0c0-7.5-6.08-13.58-13.58-13.58h-120.55c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.51,6.08-13.59,13.58-13.59h358.75c7.5,0,13.58,6.08,13.58,13.58h0c0,7.51-6.08,13.59-13.58,13.59h-183.43c-7.5,0-13.58,6.08-13.58,13.58Z",
    "M283.83,95.07h0c0,7.51,6.08,13.59,13.58,13.59h27.07c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58H96.69c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h100.87c7.5,0,13.58-6.08,13.58-13.58h0c0-7.51-6.08-13.59-13.58-13.59H32.88c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h106.17c7.5,0,13.58-6.08,13.58-13.58h0c0-7.5-6.08-13.58-13.58-13.58H13.58C6.08,27.17,0,21.09,0,13.59h0C0,6.08,6.08,0,13.58,0h300.92c7.5,0,13.58,6.08,13.58,13.58h0c0,7.51-6.08,13.59-13.58,13.59h-116.68c-7.5,0-13.58,6.08-13.58,13.58h0c0,7.5,6.08,13.58,13.58,13.58h136.68c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58h-37.09c-7.5,0-13.58,6.08-13.58,13.58Z",
    "M290.38,40.74h0c0,7.5,6.08,13.58,13.58,13.58h60.54c7.5,0,13.58,6.08,13.58,13.58h0c0,7.51-6.08,13.59-13.58,13.59h-177.19c-7.5,0-13.58,6.08-13.58,13.58h0c0,7.5,6.08,13.58,13.58,13.58h138.13c7.5,0,13.58,6.08,13.58,13.58h0c0,7.51-6.08,13.59-13.58,13.59H89.43c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.51,6.08-13.59,13.58-13.59h34.49c7.5,0,13.58-6.08,13.58-13.58h0c0-7.5-6.08-13.58-13.58-13.58h-40.23c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.51,6.08-13.59,13.58-13.59h150.83c7.5,0,13.58-6.08,13.58-13.58h0c0-7.5-6.08-13.58-13.58-13.58H102.97c-7.5,0-13.58-6.08-13.58-13.58h0c0-7.5,6.08-13.58,13.58-13.58h277.19c7.5,0,13.58,6.08,13.58,13.58h0c0,7.5-6.08,13.58-13.58,13.58h-76.2c-7.5,0-13.58,6.08-13.58,13.58Z",
  ];

  const currentPath = ref(cloudPaths[startIndex]);
  let currentIndex = startIndex;

  function morphToNextCloud() {
    const nextIndex = (currentIndex + 1) % cloudPaths.length;
    if (!el.value) return; // Defensive: skip if not mounted
    gsap.to(el.value, {
      duration: 6,
      morphSVG: { shape: cloudPaths[nextIndex] },
      ease: "linear",
      onComplete: () => {
        currentPath.value = cloudPaths[nextIndex];
        currentIndex = nextIndex;
        morphToNextCloud();
      },
    });
  }

  onMounted(() => {
    watchEffect(() => {
      if (el.value) {
        morphToNextCloud();
      }
    });
  });

  return currentPath;
}
